This is standard topological sort. We construct a directed graph between characters and use Kahn's algorithm to generate a valid ordering of the nodes.