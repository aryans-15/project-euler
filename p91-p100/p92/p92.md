The number of unique chains is quite small, so a memoized brute force suffices.